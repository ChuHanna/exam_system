<% provide :title, t(".title") %>

<h1 class="h3 mb-2 text-gray-800"><%= t".title" %></h1>

<div class="card shadow mb-4">
  <div class="card-header py-3">
    <%= render "exams/search" %>
  </div>
  <div class="card-body">
    <% if can? :manage, Exam %>
      <%= link_to(new_exam_path, class: "nav-link") do %>
        <i class="fas fa-plus-circle"></i>
        <%= t ".create" %>
      <% end %>
    <%end%>
    <div class="table-responsive">
      <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
        <thead>
          <tr>
            <th><%= t ".id" %></th>
            <th><%= t ".subject" %></th>
            <th><%= t ".topic_name" %></th>
            <th><%= t ".user_name" %></th>
            <th><%= t ".question_number" %></th>
            <th><%= t ".score" %></th>
            <th><%= t ".time" %></th>
            <th><%= t ".action" %></th>
          </tr>
        </thead>
        <tbody>
          <% @exams.each_with_index do |exam, index| %>
            <% if (current_user == exam.user) %>
              <tr>
                <td><%= index + 1 %></td>
                <td><%= truncate(exam.topic.subject.description, length: 15) %></td>
                <td><%= truncate(exam.topic.name, length: 15) if exam.topic %></td>
                <td><%= truncate(exam.user.name, length: 15) if exam.user.name %></td>
                <td><%= exam.questions_exams.count %></td>
                <td><%= exam.result.score if exam.result %>/<%= exam.questions_exams.count%></td>
                <td><%= spent_time(exam.time_end, exam.time_start) unless exam.time_end == nil %></td>
                <td center>
                  <%if (can? :read, Exam) && exam.result %>
                    <%= link_to( exam, class: "btn-info btn-circle btn-sm") do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                  <%end%>
                  <% if can? :manage, Exam %>
                    <%= link_to("#", class: "btn-danger btn-circle btn-sm") do %>
                      <i class="fas fa-trash"></i>
                    <% end %>
                  <%end%>
                  <%= link_to t(".start"), exam, class:"btn btn-success button", id:"exam" unless exam.result && exam.result.score %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <%== pagy_bootstrap_nav(@pagy) %>
    </div>
  </div>
</div>
